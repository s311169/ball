<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>斜拋運動模擬</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; }
canvas { border: 1px solid black; background: #eef; display: block; margin: 10px auto; }
.controls { margin: 15px; }
label { display: block; margin-top: 5px; }
button { margin: 5px; padding: 6px 12px; font-size: 16px; }
#displacement { margin-top: 10px; font-size: 18px; }
</style>
</head>
<body>
<h2>⚽ 斜拋運動模擬</h2>
<canvas id="canvas" width="800" height="400"></canvas>

<div class="controls">
  <label>初速 v₀ (m/s): <input type="range" id="v0" min="10" max="100" value="50"> <span id="v0_val">50</span></label>
  <label>仰角 θ (度): <input type="range" id="theta" min="-45" max="80" value="45"> <span id="theta_val">45</span></label>
  <label>初始高度 h₀ (m): <input type="range" id="h0" min="0" max="100" value="0"> <span id="h0_val">0</span></label>
  <button id="startBtn">開始</button>
  <button id="pauseBtn">暫停</button>
  <button id="resetBtn">重設</button>
</div>

<div id="displacement">
  水平位移 X: <span id="dispX">0</span> m ，鉛直位移 Y: <span id="dispY">0</span> m
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const v0Slider = document.getElementById("v0");
const thetaSlider = document.getElementById("theta");
const h0Slider = document.getElementById("h0");

const v0Val = document.getElementById("v0_val");
const thetaVal = document.getElementById("theta_val");
const h0Val = document.getElementById("h0_val");

const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");

const dispX = document.getElementById("dispX");
const dispY = document.getElementById("dispY");

const g = 9.8; // m/s²
const scale = 4; // 1 m -> 4 px
const dt = 0.02;

let v0 = parseFloat(v0Slider.value);
let theta = parseFloat(thetaSlider.value) * Math.PI/180;
let h0 = parseFloat(h0Slider.value);

let ball = {x:0, y:0, vx:0, vy:0, t:0};
let animating = false;
let paused = false;
let trajectory = [];

function updateLabels(){
  v0Val.textContent = v0Slider.value;
  thetaVal.textContent = thetaSlider.value;
  h0Val.textContent = h0Slider.value;
}

v0Slider.oninput = () => { updateLabels(); if(!animating) resetBall(); };
thetaSlider.oninput = () => { updateLabels(); if(!animating) resetBall(); };
h0Slider.oninput = () => { updateLabels(); if(!animating) resetBall(); };

function resetBall(){
  v0 = parseFloat(v0Slider.value);
  theta = parseFloat(thetaSlider.value) * Math.PI/180;
  h0 = parseFloat(h0Slider.value);

  ball.x = 0;
  ball.y = h0;
  ball.vx = v0 * Math.cos(theta);
  ball.vy = v0 * Math.sin(theta);
  ball.t = 0;
  trajectory = [{x: ball.x, y: ball.y}];

  paused = false;
  updateDisplacement();
  drawScene();
}

function updateDisplacement(){
  dispX.textContent = ball.x.toFixed(2);
  dispY.textContent = ball.y.toFixed(2);
}

function drawScene(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let offsetX = ball.x*scale - canvas.width/4;
  let offsetY = ball.y*scale - canvas.height/2;
  if(offsetX < 0) offsetX = 0;
  if(offsetY < 0) offsetY = 0;

  // 水平比例尺
  let maxHorizontal = offsetX/scale + canvas.width/scale + 20;
  for(let i=0;i<=maxHorizontal;i+=10){
    let px = i*scale - offsetX;
    ctx.beginPath();
    ctx.moveTo(px,0);
    ctx.lineTo(px,canvas.height);
    ctx.strokeStyle="#aaa"; ctx.lineWidth=1;
    ctx.stroke();
    ctx.fillStyle="black";
    ctx.fillText(i+" m", px+2, canvas.height-2);
  }

  // 垂直比例尺
  let maxVertical = offsetY/scale + canvas.height/scale + 20;
  for(let j=0;j<=maxVertical;j+=10){
    let py = canvas.height-(j*scale - offsetY);
    ctx.beginPath();
    ctx.moveTo(0,py);
    ctx.lineTo(canvas.width,py);
    ctx.strokeStyle="#aaa"; ctx.lineWidth=1;
    ctx.stroke();
    ctx.fillStyle="black";
    ctx.fillText(j+" m", 2, py-2);
  }

  // 軌跡
  ctx.beginPath();
  for(let i=0;i<trajectory.length;i++){
    let p = trajectory[i];
    let px = p.x*scale - offsetX;
    let py = canvas.height - (p.y*scale - offsetY);
    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  }
  ctx.strokeStyle = "blue";
  ctx.lineWidth = 2;
  ctx.stroke();

  // 球
  ctx.beginPath();
  let ballX = ball.x*scale - offsetX;
  let ballY = canvas.height - (ball.y*scale - offsetY);
  ctx.arc(ballX, ballY, 8, 0, 2*Math.PI);
  ctx.fillStyle = paused ? "orange" : "red"; // 暫停顏色提示
  ctx.fill();
  ctx.stroke();
}

function animate(){
  if(!animating) return;

  ball.t += dt;
  ball.x = ball.vx * ball.t;
  ball.y = h0 + ball.vy * ball.t - 0.5*g*ball.t*ball.t;
  if(ball.y<0) ball.y=0;
  trajectory.push({x: ball.x, y: ball.y});

  updateDisplacement();
  drawScene();

  if(ball.y<=0 && ball.t>0){
    animating=false;
    paused=false;
    drawScene();
  } else {
    requestAnimationFrame(animate);
  }
}

// 按鈕事件
startBtn.onclick = () => { 
  if(!animating){ 
    animating=true; 
    paused=false;
    animate(); 
  }
};

pauseBtn.onclick = () => {
  animating=false;
  paused=true;
  drawScene();
};

resetBtn.onclick = () => { 
  animating=false; 
  paused=false;
  resetBall(); 
};

// 初始化
updateLabels();
resetBall();
</script>
</body>
</html>
